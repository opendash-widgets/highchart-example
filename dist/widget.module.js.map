{"version":3,"file":null,"sources":["../src/widget/widget.controller.js","../src/settings/settings.controller.js","../src/presets.js","../src/index.js"],"sourcesContent":["export default class WidgetController {\n\n  static $inject = ['od.adapter.service', '$element', '$scope', 'moment', 'lodash'];\n\n  constructor($adapter, $element, $scope, moment, lodash) {\n\n    this.$adapter = $adapter;\n    this.$adapter = $adapter;\n    this.$scope = $scope;\n    this.moment = moment;\n    this.lodash = lodash;\n\n    this.loadDevice(this.config.id || null);\n\n    // Highchart-ng Data:\n    this.hcData = {\n      chart: {\n        type: \"line\",\n      },\n      series: [],\n    }\n  }\n\n  loadDevice(id) {\n\n    if(!id) return null;\n\n    let $adapter = this.$adapter;\n    let _ = this.lodash;\n\n    let request = this.$adapter.get(id)\n    \n    request.then(data => {\n      \n      this.device = data;\n\n      this.loadHistory(data);\n\n    });\n\n    request.then(null, console.error);\n  }\n\n  getSensor(device) {\n    return this.lodash.filter(device.sensors, sensor => sensor['@type'] === 'od.sensor.currenttemp')[0] || null;\n  }\n\n  loadHistory(device) {\n\n    let $adapter = this.$adapter;\n    let moment = this.moment;\n    let _ = this.lodash;\n\n    let sensor = this.getSensor(device);\n    let sensorId = sensor['@id'];\n\n    if(!sensor) return [];\n\n    let request = this.$adapter.values({\n      id: sensorId,\n      history: {\n        aggregation: 3,\n        since: moment().subtract(10, 'day')\n      }\n    });\n    \n    request.then(values => {\n\n      values = _.map(values, value => value.value);\n\n      console.log(values);\n\n      this.hcData.series.push({\n        name: device.name,\n        type: 'area',\n        data: values,\n      });\n\n    });\n\n    request.then(null, console.error);\n  }\n}","export default class SettingsController {\n\n  static $inject = ['od.adapter.service', 'lodash'];\n\n  constructor($adapter, lodash) {\n\n    this.$adapter = $adapter;\n    this.lodash = lodash;\n\n    this.loadDevices();\n  }\n\n  loadDevices() {\n\n    let $adapter = this.$adapter;\n    let _ = this.lodash;\n\n    let request = this.$adapter.list({})\n    \n    request.then(data => {\n\n      data = _.filter(data, device => this.isSupported(device['@type']));\n\n      data = _.map(data, device => {\n        return {\n          id: device['@id'],\n          name: device.name,\n        };\n      });\n\n      this.devices = data;\n    })\n\n    request.then(null, console.error);\n  }\n\n  isSupported(key) {\n    switch (key) {\n      case 'od.device.Room:Thermostat':\n        return true;\n    \n      default:\n        return false;\n    }\n  }\n}","export default [\n    {\n        name: 'Highchart Example',\n        image: '/assets/vendor/opendash-widget-highchart-example/assets/preset.png',\n        description: 'Beispiel fÃ¼r die Nutzung von Highchart in open.DASH2',\n        config: {\n            name: 'Highchart Example',\n            config: {\n\n            },\n        },\n    },\n];","import widgetController from './widget/widget.controller.js';\nimport widgetTemplate from './widget/widget.template.html';\n\nimport settingsController from './settings/settings.controller.js';\nimport settingsTemplate from './settings/settings.template.html';\n\nimport defaultPresets from './presets';\n\nexport default (options) => {\n    \n    options = options || {};\n\n    let presets = options.presets || defaultPresets;\n\n    return {\n        widgetController,\n        widgetTemplate,\n        settingsController,\n        settingsTemplate,\n        presets,\n    };\n};\n"],"names":["WidgetController","$adapter","$element","$scope","moment","lodash","loadDevice","config","id","hcData","_","request","get","then","device","data","loadHistory","console","error","filter","sensors","sensor","getSensor","sensorId","values","subtract","map","value","log","series","push","name","$inject","SettingsController","loadDevices","list","isSupported","devices","key","options","presets","defaultPresets"],"mappings":"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"}